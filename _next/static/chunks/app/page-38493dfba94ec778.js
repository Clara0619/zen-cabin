(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2635:function(e,t,s){Promise.resolve().then(s.bind(s,3912))},3912:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Y}});var n=s(7437),r=s(2265),l=s(8614),a=s(521);let o=[{sequence:["wood","wood","stone"],result:"cabin",level:1},{sequence:["wood","stone","wood"],result:"fence",level:1},{sequence:["stone","stone","stone"],result:"well",level:1},{sequence:["wood","food","stone","wood"],result:"quarry",level:2},{sequence:["wood","stone","food","wood"],result:"garden",level:2},{sequence:["food","stone","wood","stone","food"],result:"tower",level:3},{sequence:["stone","wood","food","wood","stone"],result:"shed",level:3}],i={wood:0,stone:0,food:0};function c(e){return e.sequence.length}function d(){return Array.from({length:8},()=>Array.from({length:8},()=>({building:null})))}function x(e){return Array.from({length:e},()=>null)}function b(){return(0,n.jsxs)("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[(0,n.jsx)(a.E.div,{className:"cloud cloud-1",animate:{x:[0,30,0]},transition:{duration:20,repeat:1/0,ease:"linear"}}),(0,n.jsx)(a.E.div,{className:"cloud cloud-2",animate:{x:[0,-25,0]},transition:{duration:18,repeat:1/0,ease:"linear"}}),(0,n.jsx)(a.E.div,{className:"cloud cloud-3",animate:{x:[0,20,0]},transition:{duration:22,repeat:1/0,ease:"linear"}}),(0,n.jsx)(a.E.div,{className:"cloud cloud-4",animate:{x:[0,-15,0]},transition:{duration:16,repeat:1/0,ease:"linear"}})]})}var u=s(8997),m=s(7711),p=s(4794);function h(e){let{type:t,className:s="w-8 h-8"}=e;return"wood"===t?(0,n.jsxs)("span",{className:"inline-block ".concat(s," relative"),children:[(0,n.jsx)("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-3 border-2 border-zen-border rounded-none",style:{backgroundColor:"#5d4037"}}),(0,n.jsx)("span",{className:"absolute top-0 left-0 right-0 h-2/3 border-2 border-zen-border rounded-none",style:{backgroundColor:"#88B04B",boxShadow:"inset 0 0 0 2px #6b8e23"}})]}):"stone"===t?(0,n.jsx)("span",{className:"inline-block ".concat(s," border-2 border-zen-border rounded-none"),style:{backgroundColor:"#6B7B8C",boxShadow:"inset 2px 2px 0 rgba(255,255,255,0.2), inset -2px -2px 0 rgba(0,0,0,0.2)"}}):"food"===t?(0,n.jsx)("span",{className:"inline-block ".concat(s," border-2 border-zen-border rounded-none"),style:{backgroundColor:"#F7CAC9",boxShadow:"inset 0 0 0 2px #e8a0a0"}}):null}function f(e){let{score:t,timeLeft:s,logicLoadPercent:r,heartsFilled:l,hpHearts:o,wood:i,stone:c,food:d,canEatFood:x,onEatFood:b}=e;return(0,n.jsxs)(a.E.header,{initial:{y:-16,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",stiffness:500,damping:30},className:"pixel-box-8 rounded-none relative z-10 border-8 border-zen-border bg-[#e8e0c8] px-3 py-2",children:[(0,n.jsx)("p",{className:"text-sm text-zen-border mb-1.5 font-bold",children:"RESOURCE OVERLAY"}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex items-end gap-4",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)(h,{type:"wood",className:"w-10 h-10"}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"WOOD"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)("div",{className:"flex gap-0.5",children:Array.from({length:o}).map((e,t)=>(0,n.jsx)("span",{className:"w-4 h-4 flex items-center justify-center border-2 border-zen-border rounded-none",style:{backgroundColor:t<l?"#e74c3c":"#ccc"},children:t<l&&(0,n.jsx)(u.Z,{className:"w-2 h-2 text-white fill-white"})},t))}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"HP"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)("span",{className:"w-10 h-10 flex items-center justify-center border-2 border-zen-border rounded-none bg-amber-700",children:(0,n.jsx)(m.Z,{className:"w-5 h-5 text-amber-200"})}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"-5"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)(h,{type:"food",className:"w-10 h-10"}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"FOOD"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)(h,{type:"stone",className:"w-10 h-10"}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"STONE"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)("span",{className:"w-10 h-10 flex items-center justify-center border-2 border-zen-border rounded-none bg-amber-800",children:(0,n.jsx)(p.Z,{className:"w-5 h-5 text-amber-200"})}),(0,n.jsx)("span",{className:"text-xs text-zen-border",children:"SCORE"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zen-border flex-wrap",children:[(0,n.jsxs)("span",{children:["HP: ",l,"/",o]}),(0,n.jsxs)("span",{children:["wood: ",i]}),(0,n.jsxs)("span",{children:["food: ",d]}),(0,n.jsxs)("span",{children:["stone: ",c]}),(0,n.jsx)("span",{children:"进食 +25 HP"}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:b,disabled:!x,className:"pixel-btn px-2 py-1 border-2 text-xs disabled:opacity-50",children:"进食 +HP"})]})]}),(0,n.jsxs)("div",{className:"flex gap-4 mt-1.5 text-xs text-zen-border",children:[(0,n.jsxs)("span",{children:["TIME: ",function(e){let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60),":").concat((t%60).toString().padStart(2,"0"))}(s)]}),(0,n.jsxs)("span",{children:["LOGIC LOAD: ",Math.round(r),"%"]}),(0,n.jsxs)("span",{children:["SCORE: ",t]})]})]})}var j=s(4938),g=s(6595);function N(e){let{className:t}=e;return(0,n.jsxs)("span",{className:"inline-block relative overflow-visible ".concat(null!=t?t:"w-10 h-10"),style:{fontSize:"1em"},title:"小木屋",children:[(0,n.jsxs)("span",{className:"absolute inset-0 flex flex-col items-center justify-end pb-[8%] text-[100%]",children:[(0,n.jsx)("span",{className:"absolute left-1/2 -translate-x-1/2 top-0 block",style:{width:0,height:0,borderLeftWidth:"0.5em",borderRightWidth:"0.5em",borderBottomWidth:"0.44em",borderLeftStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftColor:"transparent",borderRightColor:"transparent",borderBottomColor:"#8B4513"}}),(0,n.jsx)("span",{className:"w-[85%] h-[52%] rounded-b-sm border-2 border-zen-border block",style:{backgroundColor:"#d4a574"}})]}),(0,n.jsx)("span",{className:"absolute bottom-[8%] left-1/2 -translate-x-1/2 w-[22%] h-[28%] rounded-b border-2 border-zen-border block",style:{backgroundColor:"#5d4037"}}),(0,n.jsx)("span",{className:"absolute bottom-[32%] right-[18%] w-[16%] h-[18%] rounded border-2 border-zen-border bg-sky-300 block"})]})}function y(e){let{className:t}=e;return(0,n.jsx)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"栅栏",children:(0,n.jsx)("span",{className:"absolute inset-0 flex items-end justify-center gap-[6%] pb-[5%]",children:[0,1,2].map(e=>(0,n.jsx)("span",{className:"w-[18%] border-2 border-zen-border rounded-sm block",style:{height:"70%",backgroundColor:"#8B7355"}},e))})})}function w(e){let{className:t}=e;return(0,n.jsx)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"水井",children:(0,n.jsxs)("span",{className:"absolute inset-0 flex flex-col items-center justify-end",children:[(0,n.jsx)("span",{className:"w-[55%] h-[50%] rounded-t border-2 border-zen-border block",style:{backgroundColor:"#6B7B8C"}}),(0,n.jsx)("span",{className:"w-[70%] h-[8%] border-2 border-zen-border block",style:{backgroundColor:"#5d4037"}})]})})}function v(e){let{className:t}=e;return(0,n.jsx)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"石矿",children:(0,n.jsx)("span",{className:"absolute inset-0 flex items-end flex-wrap justify-center gap-[4%] pb-[5%] px-[5%]",children:[0,1,2,3,4].map(e=>(0,n.jsx)("span",{className:"w-[26%] h-[35%] border-2 border-zen-border rounded-sm block",style:{backgroundColor:"#7a8a9a"}},e))})})}function z(e){let{className:t}=e;return(0,n.jsxs)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"花园",children:[(0,n.jsx)("span",{className:"absolute bottom-[10%] left-1/2 -translate-x-1/2 w-[30%] h-[25%] rounded border-2 border-zen-border block",style:{backgroundColor:"#5d4037"}}),(0,n.jsx)("span",{className:"absolute bottom-[28%] left-[25%] w-[18%] h-[22%] rounded-full border-2 border-zen-border block bg-zen-wood"}),(0,n.jsx)("span",{className:"absolute bottom-[32%] right-[28%] w-[14%] h-[18%] rounded-full border-2 border-zen-border block bg-zen-food"})]})}function k(e){let{className:t}=e;return(0,n.jsx)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"塔楼",children:(0,n.jsxs)("span",{className:"absolute inset-0 flex flex-col items-center justify-end gap-0 pb-[5%]",children:[(0,n.jsx)("span",{className:"w-[35%] h-[25%] border-2 border-zen-border rounded-t block",style:{backgroundColor:"#8B7355"}}),(0,n.jsx)("span",{className:"w-[45%] h-[35%] border-2 border-zen-border block",style:{backgroundColor:"#6B7B8C"}}),(0,n.jsx)("span",{className:"w-[55%] h-[30%] border-2 border-zen-border rounded-t block",style:{backgroundColor:"#5d4037"}})]})})}function C(e){let{className:t}=e;return(0,n.jsx)("span",{className:"inline-block relative ".concat(null!=t?t:"w-10 h-10"),title:"棚屋",children:(0,n.jsxs)("span",{className:"absolute inset-0 flex flex-col items-center justify-end pb-[5%]",children:[(0,n.jsx)("span",{className:"w-[75%] h-[8%] border-2 border-zen-border block",style:{backgroundColor:"#8B4513"}}),(0,n.jsx)("span",{className:"w-[80%] h-[55%] rounded-b-sm border-2 border-zen-border block",style:{backgroundColor:"#a0826d"}})]})})}function E(e){let{type:t,className:s="w-10 h-10"}=e;switch(t){case"cabin":return(0,n.jsx)(N,{className:s});case"fence":return(0,n.jsx)(y,{className:s});case"well":return(0,n.jsx)(w,{className:s});case"quarry":return(0,n.jsx)(v,{className:s});case"garden":return(0,n.jsx)(z,{className:s});case"tower":return(0,n.jsx)(k,{className:s});case"shed":return(0,n.jsx)(C,{className:s});default:return(0,n.jsx)("span",{className:"inline-block ".concat(s," rounded-lg border-2 border-zen-border flex items-center justify-center bg-amber-200 text-[0.5em]"),children:"?"})}}let S="2.75rem";function T(e){let{grid:t,selectedBuildingForPlace:s,onCellClick:r,pendingBuildings:l=[],inventory:a={wood:0,stone:0,food:0}}=e;return(0,n.jsxs)("div",{className:"flex gap-2 items-stretch relative z-10",children:[(0,n.jsxs)("div",{className:"pixel-box-8 p-2 grass-bg border-8 border-zen-border rounded-none flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1.5 mb-2",children:[(0,n.jsx)("span",{className:"w-6 h-6 flex items-center justify-center border-2 border-zen-border rounded-none bg-amber-800",children:(0,n.jsx)(j.Z,{className:"w-3 h-3 text-amber-200"})}),(0,n.jsx)("span",{className:"text-sm text-zen-border font-bold",children:"HOME GRID"}),s&&(0,n.jsx)("span",{className:"text-amber-400",title:"选择格子放置",children:(0,n.jsx)(g.Z,{className:"w-4 h-4 fill-amber-400"})})]}),(0,n.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(8,", ").concat(S,")"),gridTemplateRows:"repeat(".concat(8,", ").concat(S,")")},children:t.map((e,t)=>e.map((e,l)=>(0,n.jsx)(M,{cell:e,row:t,col:l,isSelectedMode:!!s,onPlace:()=>r(t,l)},"".concat(t,"-").concat(l))))})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 shrink-0",children:[(0,n.jsxs)("div",{className:"pixel-box-8 p-1.5 border-8 border-zen-border rounded-none bg-[#e8e0c8]",children:[(0,n.jsx)("p",{className:"text-xs text-zen-border mb-1",children:"待放置"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-1",children:[0,1,2,3].map(e=>(0,n.jsx)("div",{className:"w-10 h-10 border-2 border-zen-border rounded-none flex items-center justify-center bg-amber-100",children:l[e]?(0,n.jsx)(E,{type:l[e],className:"w-8 h-8"}):(0,n.jsx)("span",{className:"text-zen-border/30 text-xs",children:"空"})},e))})]}),(0,n.jsxs)("div",{className:"pixel-box-8 p-1.5 border-8 border-zen-border rounded-none bg-[#e8e0c8]",children:[(0,n.jsx)("p",{className:"text-xs text-zen-border mb-1",children:"资源"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,n.jsxs)("div",{className:"w-10 h-10 flex flex-col items-center justify-center border-2 border-zen-border rounded-none bg-white",children:[(0,n.jsx)(h,{type:"wood",className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-[10px]",children:a.wood})]}),(0,n.jsxs)("div",{className:"w-10 h-10 flex flex-col items-center justify-center border-2 border-zen-border rounded-none bg-white",children:[(0,n.jsx)(h,{type:"stone",className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-[10px]",children:a.stone})]}),(0,n.jsxs)("div",{className:"w-10 h-10 flex flex-col items-center justify-center border-2 border-zen-border rounded-none bg-white col-span-2",children:[(0,n.jsx)(h,{type:"food",className:"w-5 h-5"}),(0,n.jsxs)("span",{className:"text-[10px]",children:["浆果 ",a.food]})]})]})]})]})]})}function M(e){let{cell:t,row:s,col:r,isSelectedMode:l,onPlace:o}=e,i=null!==t.building;return(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},transition:{type:"spring",stiffness:500},onClick:o,className:"\n        w-full h-full border-4 border-zen-border flex items-center justify-center relative\n        ".concat(i?"brick-cell bg-zen-wood/30":"brick-cell","\n        ").concat(l&&!i?"ring-2 ring-amber-400 ring-offset-1":"","\n      "),style:{minWidth:S,minHeight:S},children:i?(0,n.jsx)(a.E.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:28},className:"inline-flex items-center justify-center w-full h-full",style:{fontSize:"2rem"},children:(0,n.jsx)(E,{type:t.building,className:"w-[2rem] h-[2rem] min-w-[2rem] min-h-[2rem]"})}):(0,n.jsxs)("span",{className:"text-[10px] text-zen-border/40",children:[s,",",r]})})}let B=[{type:"wood",label:"树木"},{type:"stone",label:"石头"},{type:"food",label:"浆果"}];function R(e){let{canGather:t,onGather:s}=e,[l,o]=(0,r.useState)(!1);return(0,n.jsxs)("div",{className:"pixel-box-8 p-4 bg-white border-8 border-zen-border rounded-none flex flex-col gap-3 relative z-10",children:[(0,n.jsx)("p",{className:"text-sm text-zen-border",children:"采集 \xb7 消耗体力"}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:B.map(e=>{let{type:r,label:i}=e,c="wood"===r;return(0,n.jsxs)(a.E.button,{type:"button",whileTap:c?void 0:{scale:.95},animate:c&&l?{rotate:[0,-14,14,-14,14,0],x:[0,2,-2,2,-2,0]}:{},transition:{type:"spring",stiffness:500,damping:15},onAnimationComplete:c?()=>o(!1):void 0,onClick:()=>{s(r),c&&t&&o(!0)},disabled:!t,className:"pixel-btn flex items-center gap-3 px-4 py-3 border-4 border-zen-border rounded-none ".concat(t?"bg-white":"bg-gray-300 opacity-70 cursor-not-allowed"),children:[(0,n.jsx)(h,{type:r,className:"w-10 h-10 shrink-0"}),(0,n.jsx)("span",{className:"text-sm text-zen-border",children:i})]},r)})}),!t&&(0,n.jsx)("p",{className:"text-xs text-zen-border/80",children:"体力不足 \xb7 每5秒+1 或 进食浆果"})]})}var O=s(1769),q=s(3454),F=s(5368),P=s(6399),L=s(8728);let A={wood:"木",stone:"石",food:"果"},I={cabin:"小木屋",fence:"栅栏",well:"水井",quarry:"石矿",garden:"花园",tower:"塔楼",shed:"棚屋",barn:"谷仓",mill:"磨坊",fort:"堡垒",shrine:"神龛",bridge:"桥",gate:"大门",lighthouse:"灯塔",villa:"别墅"};function H(e){var t;let{craftSlots:s,currentRecipe:i,recipeVisible:c,isReversedRule:d,craftFeedback:x,pendingBuildings:b,selectedBuildingForPlace:u,inventory:m,putCraftSlot:p,removeFromCraftSlot:f,tryCraft:j,selectBuildingToPlace:g,startFlashMemory:N,onFakeResourceClick:y,memorySecondsLeft:w,gameOver:v}=e,[z,k]=(0,r.useState)(!1),C=null!==(t=null==i?void 0:i.sequence.length)&&void 0!==t?t:3,S=s.length===C&&s.every(e=>null!==e)&&!c&&!v;(0,r.useEffect)(()=>{if("success"===x)try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=880,t.type="sine",s.gain.setValueAtTime(.15,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.15),t.start(e.currentTime),t.stop(e.currentTime+.15)}catch(e){}},[x]);let T=s.findIndex(e=>null===e);return(0,n.jsxs)("div",{className:"flex items-stretch gap-2 relative z-10",children:[(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:()=>k(!0),className:"pixel-btn p-2 bg-white border-4 border-zen-border shrink-0",title:"配方书",children:(0,n.jsx)(O.Z,{className:"w-5 h-5 text-zen-border"})}),(0,n.jsx)(l.M,{children:z&&(0,n.jsx)(D,{onClose:()=>k(!1),recipes:o},"recipe-book")}),(0,n.jsxs)(a.E.div,{animate:{boxShadow:"fail"===x?["0 0 0 4px #0d0d0d","0 0 0 8px #e74c3c","0 0 0 4px #0d0d0d"]:"0 0 0 4px #0d0d0d",backgroundColor:"fail"===x?"#2d0000":void 0},transition:{duration:.15,repeat:"fail"===x?2:0},className:"pixel-box-8 flex-1 p-3 bg-[#3d3a35] border-8 border-zen-border rounded-none flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-10 h-10 flex items-center justify-center border-2 border-zen-border rounded-none bg-amber-800",children:(0,n.jsx)(q.Z,{className:"w-5 h-5 text-amber-200"})}),(0,n.jsx)("span",{className:"text-sm text-amber-100",children:"CRAFTING STATION"}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:()=>k(!0),className:"w-7 h-7 flex items-center justify-center border-2 border-zen-border rounded-none bg-zen-border/30 ml-auto",title:"配方书",children:(0,n.jsx)(O.Z,{className:"w-3.5 h-3.5 text-white"})})]}),(0,n.jsxs)("p",{className:"text-xs text-amber-200/90",children:["采集 HP-5 \xb7 进食 HP+25 \xb7 顺序敏感 ",d&&"\xb7 已反转"]}),c&&i&&(0,n.jsxs)(a.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-yellow-300 bg-black/50 p-2 border-2 border-yellow-400",children:["[",i.sequence.map(e=>A[e]).join("-"),"] →"," ",I[i.result]]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[s.map((e,t)=>(0,n.jsx)(Z,{item:e,index:t,onRemove:()=>f(t)},t)),(0,n.jsx)("span",{className:"text-[6px] text-amber-200/70",children:"→"}),(0,n.jsxs)("div",{className:"flex gap-1 flex-wrap items-center",children:[["wood","stone","food"].map(e=>{let t=m[e]>0&&-1!==T;return(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.9},disabled:!t,onClick:()=>t&&p(T,e),className:"pixel-btn w-9 h-9 flex items-center justify-center disabled:opacity-40 border-2 border-zen-border rounded-none bg-[#2a2722]",title:e,children:(0,n.jsx)(h,{type:e,className:"w-5 h-5"})},e)}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.9},onClick:N,className:"pixel-btn w-9 h-9 flex items-center justify-center border-2 border-zen-border rounded-none bg-zen-wood/80",title:"查看配方",children:(0,n.jsx)(F.Z,{className:"w-5 h-5 text-white"})}),(0,n.jsx)(G,{onTap:y}),null!==w&&(0,n.jsxs)("span",{className:"text-xs text-yellow-300 px-1",children:[w,"s"]}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:j,disabled:!S,className:"pixel-btn w-9 h-9 flex items-center justify-center border-2 border-zen-border rounded-none bg-orange-600 disabled:opacity-50",title:"合成",children:(0,n.jsx)(P.Z,{className:"w-5 h-5 text-white"})})]})]}),"success"===x&&(0,n.jsxs)(a.E.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center pointer-events-none overflow-visible",children:[(0,n.jsx)("span",{className:"text-yellow-400 text-[10px] z-10",children:"✓ 成功!"}),[0,1,2,3,4].map(e=>(0,n.jsx)(a.E.span,{initial:{x:0,y:0,opacity:1},animate:{x:24*Math.cos(2*e*Math.PI/5),y:24*Math.sin(2*e*Math.PI/5),opacity:0},transition:{duration:.5,type:"spring",stiffness:400},className:"absolute w-1.5 h-1.5 bg-amber-400 border border-amber-600"},e))]}),b.length>0&&(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,n.jsx)("span",{className:"text-xs text-white/80",children:"待放置:"}),b.map((e,t)=>(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.9},onClick:()=>g(u===e?null:e),className:"pixel-btn p-1.5 border-4 flex items-center justify-center ".concat(u===e?"bg-zen-wood":"bg-white"),children:(0,n.jsx)(E,{type:e,className:"w-8 h-8"})},"".concat(e,"-").concat(t)))]})]})]})}function Z(e){let{item:t,index:s,onRemove:r}=e;return(0,n.jsx)(a.E.div,{whileTap:{scale:.95},transition:{type:"spring",stiffness:500},className:"w-10 h-10 brick-cell border-4 border-zen-border flex items-center justify-center cursor-pointer",onClick:()=>t&&r(),children:t?(0,n.jsx)(h,{type:t,className:"w-6 h-6"}):(0,n.jsx)("span",{className:"text-xs text-zen-border/50",children:"空"})})}function G(e){let{onTap:t}=e;return(0,n.jsx)(a.E.button,{type:"button",animate:{opacity:[.6,1,.6]},transition:{duration:1.2,repeat:1/0},onClick:t,className:"pixel-btn w-9 h-9 flex items-center justify-center border-2 border-zen-border rounded-none bg-gray-600",title:"虚假资源！点击扣体力",children:(0,n.jsx)(L.Z,{className:"w-5 h-5 text-gray-300"})})}function D(e){let{onClose:t,recipes:s}=e;return(0,n.jsx)(a.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",stiffness:500},className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",onClick:t,children:(0,n.jsxs)(a.E.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},onClick:e=>e.stopPropagation(),className:"pixel-box-8 bg-white p-4 max-w-xs border-8 border-zen-border",children:[(0,n.jsx)("p",{className:"text-sm text-zen-border mb-2",children:"配方书 \xb7 顺序敏感"}),(0,n.jsx)("ul",{className:"space-y-1 text-xs text-zen-border",children:s.map((e,t)=>(0,n.jsxs)("li",{children:["[",e.sequence.map(e=>A[e]).join("-"),"] →"," ",I[e.result]]},t))}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:t,className:"pixel-btn mt-2 px-3 py-1.5 text-xs",children:"关闭"})]})})}var V=s(3327);function _(e){let{open:t,onClose:s,title:r,subtitle:o="摆满 5 个建筑解锁"}=e;return(0,n.jsx)(l.M,{children:t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black/60 z-[60]"}),(0,n.jsxs)(a.E.div,{initial:{opacity:0,scale:.5,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:20,stiffness:300},className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[70] w-[min(92vw,280px)] pixel-box border-4 border-zen-border bg-zen-bg p-6 text-center",children:[(0,n.jsx)(a.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.15,type:"spring",stiffness:300},className:"w-16 h-16 mx-auto mb-3 flex items-center justify-center rounded-none border-4 border-amber-500 bg-amber-100",children:(0,n.jsx)(V.Z,{className:"w-8 h-8 text-amber-600"})}),(0,n.jsx)("p",{className:"text-[10px] text-zen-border/70 mb-1",children:o}),(0,n.jsx)("p",{className:"text-sm text-zen-border font-bold mb-4",children:r}),(0,n.jsx)(a.E.button,{type:"button",whileTap:{scale:.95},onClick:s,className:"pixel-btn px-4 py-2 bg-zen-wood text-white text-xs",children:"太棒了"})]})]})})}function W(e){let{show:t,recipe:s}=e;return t&&s?(0,n.jsx)(a.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/85 border-0 rounded-none",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,n.jsx)("p",{className:"text-lg text-white",children:"记住顺序 \xb7 3 秒后隐藏"}),(0,n.jsx)("div",{className:"flex items-center justify-center gap-6 flex-wrap",children:s.sequence.map((e,t)=>(0,n.jsx)(a.E.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,delay:.06*t},children:(0,n.jsx)(h,{type:e,className:"w-16 h-16 sm:w-20 sm:h-20"})},"".concat(t,"-").concat(e)))})]})}):null}function U(e){let{score:t,finalLogicLoad:s,placedBuildingCount:r}=e;return(0,n.jsx)(a.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 z-[90] flex items-center justify-center bg-black/90",children:(0,n.jsxs)(a.E.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},transition:{type:"spring",stiffness:500,damping:30},className:"pixel-box-8 w-[min(92vw,360px)] p-8 bg-white border-8 border-zen-border rounded-none text-center",children:[(0,n.jsx)("p",{className:"text-base text-zen-border mb-4",children:"GAME OVER"}),(0,n.jsx)("p",{className:"text-sm text-zen-border/80 mb-6",children:"TIME'S UP"}),(0,n.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,n.jsxs)("p",{className:"text-sm text-zen-border",children:["LOGIC LOAD: ",(0,n.jsxs)("strong",{children:[Math.round(s),"%"]})]}),(0,n.jsxs)("p",{className:"text-sm text-zen-border/80",children:["SCORE: ",t]}),(0,n.jsxs)("p",{className:"text-sm text-zen-border/80",children:["建筑数: ",r]})]}),(0,n.jsx)("p",{className:"text-xs text-zen-border/60",children:"前额叶训练完成 \xb7 刷新页面再玩一局"})]})})}function Y(){let e=function(){let[e,t]=(0,r.useState)(()=>({...i})),[s,n]=(0,r.useState)(100),[l,a]=(0,r.useState)(d),[b,u]=(0,r.useState)(0),[m,p]=(0,r.useState)(3e5),[h,f]=(0,r.useState)(()=>o[0]),[j,g]=(0,r.useState)(()=>x(c(o[0]))),[N,y]=(0,r.useState)(!1),[w,v]=(0,r.useState)(null),[z,k]=(0,r.useState)(!1),[C,E]=(0,r.useState)(!1),[S,T]=(0,r.useState)(0),[M,B]=(0,r.useState)([]),[R,O]=(0,r.useState)(null),[q,F]=(0,r.useState)("idle"),[P,L]=(0,r.useState)(!1),[A,I]=(0,r.useState)(0),H=(0,r.useMemo)(()=>{if(!h)return 0;let e=20+25*h.level;return C&&(e+=25),null===w||z||(e+=20),Math.min(100,e)},[h,C,w,z]);(0,r.useEffect)(()=>{if(P)return;let e=setInterval(()=>{n(e=>Math.min(100,e+1))},5e3);return()=>clearInterval(e)},[P]),(0,r.useEffect)(()=>{if(P)return;let e=setInterval(()=>{p(e=>Math.max(0,e-1e3))},1e3);return()=>clearInterval(e)},[P]),(0,r.useEffect)(()=>{0===m&&L(!0)},[m]),(0,r.useEffect)(()=>{P&&I(e=>0===e?H:e)},[P,H]);let[Z,G]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(null===w||P){G(null);return}let e=w+1e4,s=()=>{let s=Date.now(),n=Math.ceil((e-s)/1e3);G(n>0?n:0),s>=e&&(k(!0),v(null),g(e=>(t(t=>{let s={...t};return e.forEach(e=>{var t;e&&(s[e]=(null!==(t=s[e])&&void 0!==t?t:0)+1)}),s}),x(e.length))))};s();let n=setInterval(s,1e3);return()=>clearInterval(n)},[w,P]);let D=(0,r.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t(t=>({...t,[e]:t[e]+s}))},[]),V=(0,r.useCallback)(e=>{n(t=>Math.max(0,t-e))},[]),_=(0,r.useMemo)(()=>!P&&s>=5,[P,s]),W=(0,r.useCallback)(e=>{!P&&_&&(V(5),D(e,1))},[P,_,V,D]),U=(0,r.useMemo)(()=>!P&&e.food>=1&&s<100,[P,e.food,s]),Y=(0,r.useCallback)(()=>{P||t(e=>e.food<1?e:(n(e=>Math.min(100,e+25)),{...e,food:e.food-1}))},[P]),J=(0,r.useCallback)(()=>{if(P)return;let e=null!=h?h:o[0];f(e),g(x(c(e))),k(!1),v(null),y(!0)},[P,h]);(0,r.useEffect)(()=>{if(!N||P)return;let e=setTimeout(()=>{y(!1),v(Date.now())},3e3);return()=>clearTimeout(e)},[N,P]);let K=(0,r.useCallback)((e,s)=>{P||g(n=>{if(null!==n[e])return n;t(e=>e[s]<1?e:{...e,[s]:e[s]-1});let r=[...n];return r[e]=s,r})},[P]),Q=(0,r.useCallback)(e=>{P||g(s=>{let n=s[e];n&&t(e=>({...e,[n]:e[n]+1}));let r=[...s];return r[e]=null,r})},[P]),X=(0,r.useCallback)(()=>{!P&&h&&j.length===h.sequence.length&&j.every(e=>null!==e)&&(function(e,t,s){let n=s?[...t.sequence].reverse():t.sequence;return e.length===n.length&&e.every((e,t)=>e===n[t])}(j,h,C)?(F("success"),u(e=>e+100),B(e=>[...e,h.result]),g(x(h.sequence.length)),v(null),setTimeout(()=>F("idle"),800)):(F("fail"),V(10),g(x(h.sequence.length)),v(null),setTimeout(()=>F("idle"),600)))},[P,h,j,C,V]),$=(0,r.useCallback)(()=>{P||V(25)},[P,V]),ee=(0,r.useCallback)(e=>{P||O(e)},[P]),et=(0,r.useCallback)((e,t)=>{!P&&R&&a(s=>{if(null!==s[e][t].building)return s;if(B(e=>{let t=e.indexOf(R);return -1===t?e:e.filter((e,s)=>s!==t)}),O(null),T(e=>{let t=e+1;return t>0&&t%2==0&&E(e=>!e),t}),h){let e=function(e){let t=o.filter(t=>t.sequence.length>=e),s=t[Math.floor(Math.random()*t.length)];return null!=s?s:o[o.length-1]}(Math.min(5,h.sequence.length+(.5>Math.random()?1:0)));f(e),g(x(e.sequence.length))}return s.map((s,n)=>s.map((s,r)=>n===e&&r===t?{...s,building:R}:s))})},[P,R,h]),es=(0,r.useCallback)(e=>{B(t=>{let s=t.indexOf(e);return -1===s?t:t.filter((e,t)=>t!==s)})},[]),en=(0,r.useMemo)(()=>l.flat().filter(e=>null!==e.building).length,[l]),er=Math.min(5,Math.ceil(s/20));return{inventory:e,stamina:s,maxStamina:100,grid:l,craftSlots:j,currentRecipe:h,recipeVisible:N,memoryStartTime:w,memoryDeadlinePassed:z,memorySecondsLeft:Z,isReversedRule:C,successfulBuildCount:S,pendingBuildings:M,selectedBuildingForPlace:R,score:b,timeLeft:m,logicLoadPercent:H,craftFeedback:q,gameOver:P,finalLogicLoad:A,canGather:_,canEatFood:U,eatFood:Y,addResource:D,spendResource:(0,r.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t(t=>({...t,[e]:Math.max(0,t[e]-s)}))},[]),spendStamina:V,gather:W,startFlashMemory:J,putCraftSlot:K,removeFromCraftSlot:Q,tryCraft:X,onFakeResourceClick:$,selectBuildingToPlace:ee,placeBuilding:et,consumePendingBuilding:es,placedBuildingCount:en,heartsFilled:er,hpHearts:5}}(),[t,s]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)(!1),[j,g]=(0,r.useState)(e.isReversedRule);return(0,r.useEffect)(()=>{if(e.isReversedRule!==j&&e.successfulBuildCount>0){h(!0),g(e.isReversedRule);let t=setTimeout(()=>h(!1),3500);return()=>clearTimeout(t)}},[e.isReversedRule,e.successfulBuildCount,j]),(0,r.useEffect)(()=>{e.placedBuildingCount>=5&&!u&&(s(!0),m(!0))},[e.placedBuildingCount,u]),(0,n.jsxs)("main",{className:"min-h-screen flex flex-col bg-[#6B8EFF]",children:[(0,n.jsx)(b,{}),(0,n.jsx)(l.M,{children:p&&(0,n.jsx)(a.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 pointer-events-none",children:(0,n.jsx)("span",{className:"pixel-box-8 px-8 py-4 bg-yellow-400 border-8 border-zen-border text-zen-border text-[14px] sm:text-[16px]",children:"SEASON CHANGE"})})}),(0,n.jsx)(W,{show:e.recipeVisible,recipe:e.currentRecipe}),e.gameOver&&(0,n.jsx)(U,{score:e.score,finalLogicLoad:e.finalLogicLoad||e.logicLoadPercent,placedBuildingCount:e.placedBuildingCount}),(0,n.jsx)(_,{open:t,onClose:()=>s(!1),title:"前额叶指挥官：初级",subtitle:"摆满 5 个建筑解锁"}),(0,n.jsx)("div",{className:"relative z-10 p-2",children:(0,n.jsx)(f,{score:e.score,timeLeft:e.timeLeft,logicLoadPercent:e.logicLoadPercent,heartsFilled:e.heartsFilled,hpHearts:e.hpHearts,wood:e.inventory.wood,stone:e.inventory.stone,food:e.inventory.food,canEatFood:e.canEatFood,onEatFood:e.eatFood})}),(0,n.jsxs)("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-[1fr_auto] gap-3 p-3 min-h-0",children:[(0,n.jsx)("section",{className:"flex flex-col items-start min-w-0",children:(0,n.jsx)(T,{grid:e.grid,selectedBuildingForPlace:e.selectedBuildingForPlace,onCellClick:e.placeBuilding,pendingBuildings:e.pendingBuildings,inventory:e.inventory})}),(0,n.jsx)("aside",{className:"w-full lg:w-52 shrink-0",children:(0,n.jsx)(R,{canGather:e.canGather,onGather:e.gather})})]}),(0,n.jsx)("footer",{className:"p-3 border-t-8 border-zen-border bg-zen-brick/30",children:(0,n.jsx)(H,{craftSlots:e.craftSlots,currentRecipe:e.currentRecipe,recipeVisible:e.recipeVisible,isReversedRule:e.isReversedRule,craftFeedback:e.craftFeedback,pendingBuildings:e.pendingBuildings,selectedBuildingForPlace:e.selectedBuildingForPlace,inventory:e.inventory,putCraftSlot:e.putCraftSlot,removeFromCraftSlot:e.removeFromCraftSlot,tryCraft:e.tryCraft,selectBuildingToPlace:e.selectBuildingToPlace,startFlashMemory:e.startFlashMemory,onFakeResourceClick:e.onFakeResourceClick,memorySecondsLeft:e.memorySecondsLeft,gameOver:e.gameOver})})]})}}},function(e){e.O(0,[699,971,117,744],function(){return e(e.s=2635)}),_N_E=e.O()}]);